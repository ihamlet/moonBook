(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4fb36e14"],{"0c15":function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"item"},[a("div",{directives:[{name:"line-clamp",rawName:"v-line-clamp:20",value:1,expression:"1",arg:"20"}],staticClass:"school-name"},[e._v("\n        "+e._s(e.item["wmSearchSchool"==e.searchType?"title":"name"])+"\n    ")]),a("div",{directives:[{name:"line-clamp",rawName:"v-line-clamp:20",value:1,expression:"1",arg:"20"}],staticClass:"school-address"},[e.item["wmSearchSchool"==e.searchType?"addr":"address"]?a("span",[e._v("\n            "+e._s(e.item["wmSearchSchool"==e.searchType?"addr":"address"])+"\n        ")]):e._e()])])},o=[],i=a("e20c"),c=a("591a"),n={name:"school-list",computed:Object(i["a"])({},Object(c["c"])(["userPointState"])),props:["item","prompt","searchType"]},r=n,l=(a("4b99"),a("17cc")),h=Object(l["a"])(r,s,o,!1,null,"152efe60",null);t["a"]=h.exports},"12cc":function(e,t,a){},4108:function(e,t,a){"use strict";var s=a("bb38"),o=a.n(s);o.a},"4b99":function(e,t,a){"use strict";var s=a("c70d"),o=a.n(s);o.a},5778:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"avatar-default",class:[e.size,e.avatarClass]},[1==e.gender?a("img",{attrs:{src:"https://assets-moonbook.oss-cn-beijing.aliyuncs.com/img/boy-avatar.png",alt:"默认男孩头像"}}):a("img",{attrs:{src:"https://assets-moonbook.oss-cn-beijing.aliyuncs.com/img/girl-avatar.png",alt:"默认女孩头像"}})])},o=[],i={name:"avatar",props:["gender","size","avatarClass"]},c=i,n=(a("7335"),a("17cc")),r=Object(n["a"])(c,s,o,!1,null,"ba617808",null);t["a"]=r.exports},7335:function(e,t,a){"use strict";var s=a("12cc"),o=a.n(s);o.a},a993:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"edit-school"},[a("div",{staticClass:"fixed"},[a("form",{attrs:{action:"/"}},[a("van-search",{attrs:{placeholder:"请输入学校名称","show-action":"",shape:"round"},on:{search:e.onSearch},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[a("div",{staticClass:"theme-color",attrs:{slot:"action"},on:{click:e.onSearch},slot:"action"},[e._v("\n          搜索\n        ")])])],1)]),e.isListShow?e._e():a("div",{staticClass:"container"},[a("van-cell-group",[a("van-cell",[a("div",{staticClass:"flex flex-align type-select"},[a("div",{staticClass:"school-type"},[e._v("学校类型")]),a("div",{staticClass:"select-type flex flex-align"},e._l(e.shcoolType,function(t,s){return a("div",{key:s,staticClass:"select-btn",on:{click:function(a){return e.selectSchoolType(t,s)}}},[a("van-button",{staticClass:"theme-btn",attrs:{size:"small",type:"primary",plain:e.schoolTypeIndex!=s,round:""}},[e._v(e._s(t.name))])],1)}),0)])])],1),a("van-list",{attrs:{finished:e.finished,"finished-text":e.$store.state.slogan},on:{load:e.onLoad},model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},e._l(e.list,function(t,s){return a("van-cell",{key:s,attrs:{"is-link":"",center:""},on:{click:function(a){return e.selectSchool(t)}}},[a("schoolCard",{attrs:{item:t,searchType:t.school_id>0?"wmSearchSchool":"amapSearchSchool"}})],1)}),1)],1)])},o=[],i=(a("34a3"),a("7364"),a("3c6b"),a("7bc1"),a("e20c")),c=a("9993"),n=a("591a"),r=a("5778"),l=a("0c15"),h={name:"edit-school",components:{schoolCard:l["a"],avatar:r["a"]},computed:Object(i["a"])({},Object(n["c"])(["userPointState"])),data:function(){return{isListShow:!1,page:1,loading:!1,finished:!1,list:[],keyword:"",schoolName:"",show:!1,schoolTypeIndex:0,type:"幼儿园",shcoolType:[{name:"幼儿园",index:0},{name:"小学",index:1}],tab:[{title:"小学",content:""},{title:"幼儿园",content:""}]}},watch:{keyword:function(e){this.page=1,this.list=[],this.onSearch(e)}},methods:Object(i["a"])({},Object(n["b"])(["getSchoolList","getUserData","getSearch"]),{onLoad:function(){var e=this,t=this.userPointState.location.split(","),a={page:this.page,location:this.userPointState.location,lng:t[0],lat:t[1],school_type:this.type};this.getSchoolList(a).then(function(t){t.data.length?(e.list=e.list.concat(t.data),e.loading=!1,e.page++,e.list.length>=t.data.count&&(e.finished=!0)):(e.page=1,e.loading=!1,e.finished=!0)})},beforeClose:function(e,t){var a=this;if("confirm"===e){var s={title:this.schoolName,school_type:this.schoolType,city:this.userPointState.city};c["a"].post("/book/school/edit_school",s).then(function(e){switch(e.data.status){case 1:var s={params:{child_id:a.$route.query.id,school_id:e.data.data.school_id}};"headmaster"==a.$route.query.registerType&&(s.params.is_master=1),a.$route.query.registerType?a.thearchJoin(s):a.babyJoin(s),t();break;case 0:a.$toast(e.data.msg),t();break}})}else t()},selectSchool:function(e){var t;if(e.school_id>0)t=Object(i["a"])({},this.$route.query,{school_id:e.school_id,school_name:e.title,cityname:this.userPointState.city,lat:e.lat,lng:e.lng,amap_id:e.amap_id,typecode:e.typecode});else{var a="";if(e.cityname)a=e.cityname;else{var s=e.district.match(/省(.*?)市/);a=s?s[1]+"市":""}t=Object(i["a"])({},this.$route.query,{school_name:e.name,amap_id:e.id,lat:e.lat,lng:e.lng,cityname:a||"",typecode:e.typecode})}"headmaster"==this.$route.query.registerType?(t.is_master=1,this.$router.replace({name:"edit-manager",query:t})):this.$router.replace({name:"edit-class",query:t})},thearchJoin:function(e){var t=this;c["a"].get("/book/SchoolTeacher/bind",e).then(function(e){"teacher"==t.$route.query.registerType?t.$router.replace({name:"edit-class",query:{id:t.$route.query.id,school_id:e.data.data.school_id,pageTitle:t.$route.query.pageTitle,registerType:t.$route.query.registerType,back:t.$route.query.back,type:t.$route.query.type}}):t.$router.replace({name:"edit-manager",query:{pageTitle:t.$route.query.pageTitle,registerType:t.$route.query.registerType,type:t.$route.query.type,back:t.$route.name}})})},babyJoin:function(e){var t=this;c["a"].get("/book/babySchool/bind",e).then(function(e){e.data.status?(t.$toast.success("加入学校成功"),t.$router.push({name:"edit-class",query:{id:t.$route.query.id,school_id:e.data.data.school_id,back:t.$route.query.back,type:t.$route.query.type}}),t.getUserData()):(t.$toast.fail("操作失败"),t.$router.go(-1))})},selectSchoolType:function(e,t){this.type=e.name,this.schoolTypeIndex=t,this.page=1,this.list=[],this.onLoad()},onSearch:function(e){var t=this;if(e){var a=this.userPointState.location.split(","),s={keywords:e,location:this.userPointState.location,city:this.userPointState.city,type:0==this.schoolTypeIndex?141204:141203,datatype:"poi",lng:a[0],lat:a[1]};this.getSearch(s).then(function(e){e.resData?(t.page=1,t.list=e.resData):(t.page=1,t.onLoad())})}else this.page=1,this.onLoad()}})},u=h,d=(a("4108"),a("17cc")),p=Object(d["a"])(u,s,o,!1,null,"845dc820",null);t["default"]=p.exports},bb38:function(e,t,a){},c70d:function(e,t,a){}}]);
//# sourceMappingURL=chunk-4fb36e14.f0d4d1b4.js.map
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-78aca75f"],{"0e77":function(t,e,o){},"383f":function(t,e,o){},"386b":function(t,e,o){var s=o("5ca1"),a=o("79e5"),n=o("be13"),i=/"/g,c=function(t,e,o,s){var a=String(n(t)),c="<"+e;return""!==o&&(c+=" "+o+'="'+String(s).replace(i,"&quot;")+'"'),c+">"+a+"</"+e+">"};t.exports=function(t,e){var o={};o[t]=e(c),s(s.P+s.F*a(function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}),"String",o)}},4001:function(t,e,o){"use strict";o.r(e);var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"school-intro page-padding"},[o("van-nav-bar",{class:t.fixedHeaderBar?"theme-nav":"",attrs:{zIndex:999,title:"学校介绍",fixed:"",border:!1},on:{"click-right":t.edit}},[t.userDataState.teacher_school_id==t.$route.query.id?o("div",{class:t.fixedHeaderBar?"nav-bar-right":"theme-color",attrs:{slot:"right"},slot:"right"},[o("van-button",{class:t.readonly?"theme-btn":"",attrs:{round:"",type:"primary",size:"small"}},[t._v(" "+t._s(t.readonly?"编辑":"完成")+" ")])],1):t._e()]),o("div",{ref:"domHeight",staticClass:"head theme-background"},[o("img",{staticClass:"bg-school-3d",attrs:{src:"https://assets-moonbook.oss-cn-beijing.aliyuncs.com/school-intro.png"}})]),o("div",{staticClass:"container"},[o("div",{staticClass:"module school-info"},[o("div",{staticClass:"cell flex"},[o("div",{staticClass:"logo",on:{click:function(e){return t.uploaderType("logo")}}},[o("van-uploader",{attrs:{"after-read":t.onRead,disabled:t.readonly}},[t.schoolInfo.logo?o("img",{attrs:{src:t.schoolInfo.logo},on:{error:t.imgError}}):o("van-icon",{attrs:{name:"photograph"}})],1)],1),o("div",{staticClass:"info"},[o("div",{staticClass:"title"},[o("van-field",{staticClass:"text-input school-title",attrs:{placeholder:"请输入学校名称",border:!1,readonly:t.readonly},model:{value:t.schoolInfo.title,callback:function(e){t.$set(t.schoolInfo,"title",e)},expression:"schoolInfo.title"}})],1),o("div",{staticClass:"text level flex flex-align"},[o("div",{staticClass:"text school-level",on:{click:function(e){return t.select("level")}}},[t._v(t._s(t.schoolInfo.level?t.schoolInfo.level:"未定级"))]),o("div",{staticClass:"scale text",on:{click:function(e){return t.select("scale")}}},[t._v("\n              "+t._s(t.schoolInfo.member_range)+"\n            ")])]),o("div",{staticClass:"text school-type",on:{click:function(e){return t.select("type")}}},[t._v(t._s(t.schoolInfo.run_type))]),o("div",{staticClass:"addr"},[o("van-field",{staticClass:"text-input",attrs:{type:"textarea",rows:"1",autosize:"",placeholder:"请输入学校地址",border:!1,readonly:t.readonly},model:{value:t.schoolInfo.addr,callback:function(e){t.$set(t.schoolInfo,"addr",e)},expression:"schoolInfo.addr"}})],1)]),o("div",{staticClass:"code"},[o("img",{attrs:{src:t.codeImgURL}})])])]),t._l(t.details,function(e,s){return o("div",{key:s,staticClass:"module school-details"},[o("div",{staticClass:"module-school-title flex flex-align"},[o("img",{attrs:{src:t.titleBanner[s]}})]),"关于我们"==e.title?o("div",{staticClass:"content"},[e.content||!t.readonly?o("div",{staticClass:"about"},[o("van-field",{attrs:{type:"textarea",autosize:"",placeholder:e.content?e.content:"请添加关于我们",readonly:t.readonly,border:!1},model:{value:e.content,callback:function(o){t.$set(e,"content",o)},expression:"item.content"}}),o("div",{staticClass:"img-wrap"},[o("van-row",{attrs:{gutter:5}},t._l(e.photos,function(e,a){return o("van-col",{key:a,attrs:{span:12}},[e||!t.readonly?o("div",{staticClass:"img-grid",on:{click:function(e){return t.uploaderType(s,a)}}},[e&&!t.readonly?o("div",{staticClass:"delete-photo",on:{click:t.deletePhoto}},[o("i",{staticClass:"iconfont"},[t._v("")])]):t._e(),e?o("img",{staticClass:"img-preview",attrs:{src:e,preview:"0"}}):t.hackReset?o("van-uploader",{staticClass:"img-uploader-grid",attrs:{"after-read":t.onRead,disabled:t.readonly}},[o("div",{staticClass:"uploader-prompt"},[o("van-icon",{staticClass:"img-uploader-icon",attrs:{name:"photograph"}}),o("div",{staticClass:"prompt-text"},[t._v("请上传图片")])],1)]):t._e()],1):t._e()])}),1)],1)],1):o("div",{staticClass:"not-content"},[t._v("\n          尚未添加\n        ")])]):t._e(),"风采展示"==e.title?o("div",{staticClass:"content"},[!e.video&&t.readonly||!t.hackReset?o("div",{staticClass:"no-list"},[t._v("\n          尚未添加\n        ")]):o("div",{staticClass:"video"},[e.video.photo?o("video",{ref:"videoPlayer",refInFor:!0,attrs:{id:"video",controls:"controls",src:e.video.photo,poster:e.video.thumb,preload:"auto","x-webkit-airplay":"true",airplay:"allow","webkit-playsinline":"true","x5-playsinline":"",playsinline:"true"}}):o("div",{staticClass:"video-prompt theme-color",on:{click:function(e){return t.selectFileVideo(s)}}},[t._v("请上传视频")]),!t.readonly&&e.video.photo?o("div",{staticClass:"re-upload",on:{click:function(e){return t.selectFileVideo(s)}}},[o("div",{staticClass:"theme-color"},[t._v("没有拍摄好? 点击重新上传")]),o("div",{staticClass:"prompt-text"},[t._v("横向拍摄 视野更广")])]):t._e()])]):t._e(),"办学特色"==e.title?o("div",{staticClass:"content"},[e.list.length>0||!t.readonly?o("div",{staticClass:"item"},[t._l(e.list,function(e,a){return o("div",{key:a,staticClass:"item-content"},[o("van-row",[o("van-col",{attrs:{span:7}},[o("div",{staticClass:"img-grid",on:{click:function(e){return t.uploaderType(s,a)}}},[e.img&&!t.readonly?o("div",{staticClass:"delete-photo",on:{click:t.deletePhoto}},[o("i",{staticClass:"iconfont"},[t._v("")])]):t._e(),e.img?o("img",{staticClass:"img-preview",attrs:{src:e.img,preview:"1"}}):t.hackReset?o("van-uploader",{staticClass:"img-uploader-grid",attrs:{"after-read":t.onRead,disabled:t.readonly}},[o("div",{staticClass:"uploader-prompt"},[o("van-icon",{staticClass:"img-uploader-icon",attrs:{name:"photograph"}}),o("div",{staticClass:"prompt-text"},[t._v("请上传图片")])],1)]):t._e()],1)]),o("van-col",{attrs:{span:17}},[o("div",{staticClass:"cell"},[o("van-field",{staticClass:"text-input sub-title",attrs:{placeholder:e.sub?e.sub:"请输入标题",border:!1,readonly:t.readonly},model:{value:e.sub,callback:function(o){t.$set(e,"sub",o)},expression:"content.sub"}})],1),o("van-field",{attrs:{type:"textarea",autosize:"",placeholder:e.content?e.content:"请输入内容",readonly:t.readonly,border:!1},model:{value:e.content,callback:function(o){t.$set(e,"content",o)},expression:"content.content"}})],1)],1),t.readonly?t._e():o("div",{staticClass:"delete-item",on:{click:function(e){return t.delItem(a)}}},[o("i",{staticClass:"iconfont"},[t._v("")])])],1)}),t.readonly?t._e():o("div",{staticClass:"add-item theme-color",on:{click:t.addItem}},[t._v("\n            添加\n          ")])],2):o("div",{staticClass:"no-list"},[t._v("\n          尚未添加\n        ")])]):t._e(),"招生简章"==e.title?o("div",{staticClass:"content"},[e.content.length>0||!t.readonly?o("div",{staticClass:"chapter"},[t._m(0,!0),t._l(e.content,function(e,s){return o("div",{key:s,staticClass:"chapter-item",class:t.readonly?"chapter-field-item":""},[o("van-field",{class:t.readonly?"chapter-field":"",attrs:{type:"textarea",autosize:"",placeholder:e.text?e.text:"请输入内容",rows:"1",readonly:t.readonly,border:!1},model:{value:e.text,callback:function(o){t.$set(e,"text",o)},expression:"chapter.text"}}),t.readonly?t._e():o("div",{staticClass:"delete-item",on:{click:function(e){return t.delChapter(s)}}},[o("i",{staticClass:"iconfont"},[t._v("")])])],1)}),t.readonly?t._e():o("div",{staticClass:"add-item theme-color",on:{click:t.addChapter}},[t._v("添加段落")])],2):o("div",{staticClass:"not-content"},[t._v("\n          尚未添加\n        ")])]):t._e()])})],2),o("div",{staticClass:"footer-bar flex flex-align"},[t.readonly?o("a",{staticClass:"btn flex flex-align flex-justify a-tel",attrs:{href:"tel:"+t.schoolInfo.phone}},[o("i",{staticClass:"iconfont"},[t._v("")]),t._v("\n      咨询电话\n    ")]):o("van-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:function(e){t.phoneDialogShow=!0}}},[t._v("设置电话")]),o("van-button",{staticClass:"btn theme-btn",attrs:{type:"primary"},on:{click:t.toSchoolHome}},[t._v("校园主页")])],1),o("van-popup",{staticClass:"progress-popup",attrs:{"close-on-click-overlay":!1},model:{value:t.progressIsShow,callback:function(e){t.progressIsShow=e},expression:"progressIsShow"}},[o("div",{staticClass:"progress"},[o("div",{staticClass:"upload-upload"},[t._v("视频正在上传中...")]),0!=t.percent?o("van-progress",{attrs:{percentage:t.percent,"show-pivot":!1,color:"linear-gradient(to right, #00BCD4, #0084ff)"}}):t._e()],1)]),o("van-popup",{attrs:{position:"bottom"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[o("van-picker",{attrs:{columns:t.columns},on:{change:t.onChange}})],1),o("van-dialog",{attrs:{title:"设置联系电话","show-confirm-button":"","before-close":t.onBeforeClose,getContainer:"#app"},model:{value:t.phoneDialogShow,callback:function(e){t.phoneDialogShow=e},expression:"phoneDialogShow"}},[o("van-field",{staticClass:"phone-field",attrs:{type:"tel",maxlength:"11","input-align":"center",placeholder:"请输入手机号"},model:{value:t.schoolInfo.phone,callback:function(e){t.$set(t.schoolInfo,"phone",e)},expression:"schoolInfo.phone"}})],1),o("van-dialog",{attrs:{confirmButtonText:"我知道了",getContainer:"#app"},model:{value:t.helpShow,callback:function(e){t.helpShow=e},expression:"helpShow"}},[o("img",{attrs:{src:"https://assets-moonbook.oss-cn-beijing.aliyuncs.com/demo.gif"}}),o("div",{staticClass:"tips-help-text"},[t._v("请点选您需要修改的内容，进行修改。")])]),o("input",{ref:"selectFileVideo",attrs:{type:"file",accept:"video/*","data-type":"video",hidden:""},on:{change:t.doUpload}})],1)},a=[function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"cell"},[o("p",{staticClass:"honorifics"},[t._v("尊敬的家长朋友：")])])}],n=(o("a481"),o("673e"),o("ac6a"),o("7f7f"),o("4917"),o("cebc")),i=o("9993"),c=o("0a67"),l=o.n(c),r=o("b4bd"),d=o("bec1"),h=o("77e0"),p=o("591a"),u={name:"school-intro",mixins:[h["j"]],computed:Object(n["a"])({},Object(p["e"])("openWX",["ready"]),Object(p["c"])(["userDataState"]),{item:function(){var t={details:this.schoolInfo.introduce,title:"".concat(this.schoolInfo.title,"的学校主页"),imgUrl:location.origin+this.schoolInfo.logo};return t}}),data:function(){var t=navigator.userAgent;return{isAndroid:t.indexOf("Android")>-1||t.indexOf("Adr")>-1,isIOS:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),schoolInfo:"",readonly:!0,codeImgURL:"",titleBanner:["https://assets-moonbook.oss-cn-beijing.aliyuncs.com/school-intro-icon/title-关于我们.png","https://assets-moonbook.oss-cn-beijing.aliyuncs.com/school-intro-icon/title-风采展示.png","https://assets-moonbook.oss-cn-beijing.aliyuncs.com/school-intro-icon/title-办学特色.png","https://assets-moonbook.oss-cn-beijing.aliyuncs.com/school-intro-icon/title-招生简章.png"],details:[{title:"关于我们",content:"",photos:["","","","","","","",""]},{title:"风采展示",video:""},{title:"办学特色",list:[]},{title:"招生简章",content:[]}],type:"",ossSign:"",percent:"",hackReset:!0,progressIsShow:!1,phoneDialogShow:!1,show:!1,selectType:"",columns:[],helpShow:!1,regPhone:/^1[34578]\d{9}$/}},created:function(){this.fetchData()},updated:function(){this.wxShare()},watch:{$router:"fetchData",readonly:function(t){var e=this;localStorage.getItem("".concat(this.$route.name,"-help"))?this.helpShow=!1:(this.helpShow=!t,localStorage.setItem("".concat(this.$route.name,"-help"),!0)),t&&this.$dialog.confirm({message:"您确定要更新".concat(this.schoolInfo.title,"的学校介绍信息吗？")}).then(function(){e.schoolInfo.details=JSON.stringify(e.details),i["a"].post("/book/school/edit",e.schoolInfo).then(function(t){switch(t.data.status){case 1:e.$toast.success(t.data.msg);break}})}).catch(function(){e.fetchData()})},ready:function(){this.wxShare()}},methods:Object(n["a"])({},Object(p["b"])("openWX",["share"]),{wxShare:function(){var t=this,e={item:t.item,success:function(){t.$router.go(-1)}};t.share(e)},fetchData:function(){var t=this,e={params:{school_id:this.$route.query.id}};i["a"].get("/book/school/get_info",e).then(function(e){switch(e.data.status){case 1:t.schoolInfo=e.data.data,t.details[0].content=e.data.data.introduce,e.data.data.details&&(t.details=JSON.parse(e.data.data.details));break}}),i["a"].get("/book/api/oss_sign").then(function(e){t.ossSign=e.data.data}),this.qrcode()},edit:function(){var t=this;this.readonly=!this.readonly,this.readonly&&(this.details[2].list.forEach(function(e,o){e.sub&&e.img||t.details[2].list.splice(o,t.details[2].list.length?t.details[2].list.length:1)}),this.details[3].content.forEach(function(e,o){e.text||t.details[3].content.splice(o,t.details[3].content.length?t.details[3].content.length:1)}))},uploaderType:function(t,e){this.type=[t,e]},imgError:function(t){t.target.src="https://wx.qlogo.cn/mmopen/ajNVdqHZLLBGT5R0spIjic7Pobf19Uw0qc07mwPLicXILrafUXYkhtMTZ0WialrHiadXDKibJsRTux0WvmNuDyYRWDw/0"},qrcode:function(){var t=this;if(location.href){var e="".concat(location.href.replace("/#","/?#"));l.a.toDataURL(e).then(function(e){t.codeImgURL=e}).catch(function(t){console.error(t)})}},selectFileVideo:function(t){this.type=[t],this.$refs.selectFileVideo.click()},doUpload:function(t){var e,o=this,s=t.target.files[0],a=t.target.dataset.type,n=new FormData,c=t.target.files[0].size/1024/1024/2;e=this.isIOS?3:c>3?3:c;var l=1048576*e,r=s.slice(0,l);n.append("file",r,s.name);var d="/book/file/get_video_screen";Object(i["a"])({url:d,data:n,method:"post",onUploadProgress:function(t){o.progressIsShow=!0,o.percent=1}}).then(function(t){var e=t.data.data;o.details[o.type[0]].video={thumb:e.thumb,rotate:e.rotate,duration:Math.floor(e.duration)||15},o.upOssMedia(a,s)})},upOssMedia:function(t,e){var o=this;this.ossSign||alert("未能获取上传参数");var s=this.ossSign.host,a=new FormData,n=this.ossSign.dir+"/"+Date.now()+e.name,c=s+"/"+this.ossSign.dir+"/"+Date.now()+e.name;a.append("key",n),a.append("OSSAccessKeyId",this.ossSign.accessid),a.append("policy",this.ossSign.policy),a.append("success_action_status",200),a.append("signature",this.ossSign.signature),a.append("file",e),Object(i["a"])({url:s,data:a,method:"post",onUploadProgress:function(t){o.percent=Math.floor(t.loaded/t.total*100)}}).then(function(t){o.hackReset=!1,o.details[o.type[0]].video.photo=c,o.$nextTick(function(){o.hackReset=!0}),o.percent=0,o.progressIsShow=!1})},onRead:function(t){var e=this;Object(d["c"])(t.content,1200,.8,"blob").then(function(o){o.toBlob(function(o){e.upOssPhoto(o,t,t.content)})}),console.log(1111)},upOssPhoto:function(t,e,o){var s=this,a=new Image;a.src=o;var n=new FormData,c=this.ossSign.host,l=this.ossSign.dir+"/"+Date.now()+e.name,r=c+"/"+this.ossSign.dir+"/"+Date.now()+e.name;n.append("key",l),n.append("OSSAccessKeyId",this.ossSign.accessid),n.append("policy",this.ossSign.policy),n.append("success_action_status",200),n.append("signature",this.ossSign.signature),n.append("file",t,e.name),Object(i["a"])({url:c,data:n,method:"post",onUploadProgress:function(t){s.percent=Math.floor(t.loaded/t.total*100)}}).then(function(t){switch(s.type[0]){case"logo":s.schoolInfo.logo="".concat(r,"?x-oss-percent=image/resize,m_fill,h_200,w_200");break;case 0:s.details[s.type[0]].photos[s.type[1]]="".concat(r,"?x-oss-percent=image/resize,m_fill,h_200,w_200");break;case 2:s.details[s.type[0]].list[s.type[1]].img="".concat(r,"?x-oss-percent=image/resize,m_fill,h_200,w_200");break}s.hackReset=!1,s.$nextTick(function(){s.hackReset=!0}),s.percent=0})},deletePhoto:function(){var t=this;switch(this.hackReset=!1,this.type[0]){case 0:this.details[this.type[0]].photos[this.type[1]]="";break;case 2:this.details[this.type[0]].list[this.type[1]].img="";break}this.$nextTick(function(){t.hackReset=!0})},addChapter:function(){this.details[3].content.push({text:""})},addItem:function(){this.details[2].list.push({sub:"",content:"",img:""})},delItem:function(t){this.details[2].list.splice(t,1)},delChapter:function(t){this.details[3].content.splice(t,1)},toSchoolHome:function(){this.$router.push({name:"apps-school",query:{id:this.$route.query.id}})},select:function(t){if(this.selectType=t,!this.readonly)switch(this.show=!0,t){case"level":this.columns=r["a"];break;case"scale":this.columns=r["c"];break;case"type":this.columns=r["b"];break}},onChange:function(t,e,o){switch(this.selectType){case"level":this.schoolInfo.level=e;break;case"scale":this.schoolInfo.member_range=e;break;case"type":this.schoolInfo.run_type=e;break}},onBeforeClose:function(t,e){this.regPhone.test(this.schoolInfo.phone)?e():(e(!1),this.$toast("请输入正确手机号"))}})},f=u,v=(o("d6ef"),o("c776"),o("2877")),g=Object(v["a"])(f,s,a,!1,null,"e1a53196",null);e["default"]=g.exports},"673e":function(t,e,o){"use strict";o("386b")("sub",function(t){return function(){return t(this,"sub","","")}})},b4bd:function(t,e,o){"use strict";o.d(e,"a",function(){return s}),o.d(e,"b",function(){return a}),o.d(e,"c",function(){return n}),o.d(e,"d",function(){return i});var s=["省级示范","市级示范","市一级","市二级","市三级","示范园","一类园","二类园","普通园"],a=["民办学校","公办学校","私立学校","国际学校"],n=["1000以上","900-1000人","800-900人","700-800人","600-700人","500-600人","400-500人","300-400人","200-300人","100-200人","50-100人"],i=["班主任","带班老师","生活老师"]},c776:function(t,e,o){"use strict";var s=o("0e77"),a=o.n(s);a.a},d6ef:function(t,e,o){"use strict";var s=o("383f"),a=o.n(s);a.a}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3af0d3f0"],{"0c15":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"item"},[a("div",{directives:[{name:"line-clamp",rawName:"v-line-clamp:20",value:1,expression:"1",arg:"20"}],staticClass:"school-name"},[t._v("\n        "+t._s(t.item["wmSearchSchool"==t.searchType?"title":"name"])+"\n    ")]),a("div",{directives:[{name:"line-clamp",rawName:"v-line-clamp:20",value:1,expression:"1",arg:"20"}],staticClass:"school-address"},[t.item["wmSearchSchool"==t.searchType?"addr":"address"]?a("span",[t._v("\n            "+t._s(t.item["wmSearchSchool"==t.searchType?"addr":"address"])+"\n        ")]):t._e()])])},s=[],o=a("cebc"),n=a("591a"),c={name:"school-list",computed:Object(o["a"])({},Object(n["c"])(["userPointState"])),props:["item","prompt","searchType"]},l=c,r=(a("4b99"),a("2877")),d=Object(r["a"])(l,i,s,!1,null,"152efe60",null);e["a"]=d.exports},1120:function(t,e,a){},"350e":function(t,e,a){},"4b99":function(t,e,a){"use strict";var i=a("1120"),s=a.n(i);s.a},"640f":function(t,e,a){"use strict";var i=a("7c3c"),s=a.n(i);s.a},"7c3c":function(t,e,a){},aba1:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"search-page"},[a("form",{attrs:{action:"/"}},[a("van-search",{staticClass:"search",attrs:{placeholder:"搜索图书/幼儿园/文章",shape:"round"},on:{search:t.onSearch,cancel:t.onCancel},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},[a("div",{staticClass:"search-label",attrs:{slot:"label"},slot:"label"},[t._v(t._s(t.list[t.listIndex].name))])])],1),t.value.length>0?a("div",{staticClass:"search-type"},t._l(t.list,function(e,i){return a("van-cell",{key:i,attrs:{"is-link":""},on:{click:function(e){return t.setListIndex(i)}}},[a("div",{staticClass:"cell flex flex-align"},[a("div",{staticClass:"title"},[a("div",{staticClass:"name"},[t._v(t._s(e.name))])]),a("div",{directives:[{name:"line-clamp",rawName:"v-line-clamp:20",value:1,expression:"1",arg:"20"}],staticClass:"value"},[t._v("\n                  有"),a("span",{staticClass:"count"},[t._v(t._s(e.count))]),t._v('条与"'+t._s(t.value)+'"相关的'+t._s(e.name)+"数据\n              ")])])])}),1):t._e(),t.list[t.listIndex].content.length>0?a("div",{key:t.listIndex,staticClass:"list",class:0==t.value.length?"top":""},[a("van-list",{attrs:{finished:t.finished,"finished-text":t.$store.state.slogan},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list[t.listIndex].content,function(e,i){return a("div",{key:i,staticClass:"item"},[0==t.listIndex?a("van-cell",{key:i},[a("bookCard",{attrs:{item:e,type:t.list.title}})],1):t._e(),1==t.listIndex?a("van-cell",{key:i,on:{click:function(a){return t.toSchool(e)}}},[a("schoolCard",{attrs:{item:e,searchType:e.school_id>0?"wmSearchSchool":"amapSearchSchool"}})],1):t._e(),2==t.listIndex?a("van-cell",{key:i},[a("graphicCard",{attrs:{item:e}})],1):t._e()],1)}),0)],1):t._e()])},s=[],o=(a("a481"),a("28a5"),a("cebc")),n=a("9993"),c=a("be6b"),l=a("0c15"),r=a("a618"),d=a("591a"),h={name:"search-page",components:{bookCard:c["a"],schoolCard:l["a"],graphicCard:r["a"]},computed:Object(o["a"])({},Object(d["c"])(["userDataState","userPointState"])),data:function(){return{value:"",list:[{type:"book",name:"图书",content:[],count:0},{type:"school",name:"学校",content:[],count:0},{type:"article",name:"文章",content:[],count:0}],listIndex:0,loading:!1,finished:!1,page:1}},watch:{value:function(t){0==t.length?this.onCancel():this.onSearch()}},methods:Object(o["a"])({},Object(d["b"])(["getSearch"]),{setListIndex:function(t){this.listIndex=t},getBookList:function(){var t=this,e={params:{keyword:this.value,page:this.page}};n["a"].get("/book/SchoolShelfBook/getList",e).then(function(e){switch(e.data.status){case 1:t.list[0].content=e.data.data,t.list[0].count=e.data.count,t.page++,t.loading=!1,t.list[0].content.length>=e.data.count&&(t.finished=!0);break;case 0:t.page=1,t.list[0].content=[],t.loading=!1,t.finished=!0;break}})},getSchoolList:function(){var t=this,e=this.userPointState.location.split(","),a={keywords:this.value,city:this.userPointState.city,lng:e[0],lat:e[1],type:"141203|141204"};this.getSearch(a).then(function(e){e.resData.length?(t.list[1].count=e.resData.length,t.list[1].content=e.resData):(t.page=1,t.list[1].content=[],t.loading=!1,t.finished=!0)})},getArticleList:function(){var t=this,e={params:{keyword:this.value,page:this.page,tid:9}};n["a"].get("/book/SchoolArticle/getList",e).then(function(e){switch(e.data.status){case 1:t.list[2].content=e.data.data,t.page++,t.list[2].count=e.data.count,t.loading=!1,t.list[2].content.length>=e.data.count&&(t.finished=!0);break;case 0:t.page=1,t.list[2].content=[],t.loading=!1,t.finished=!0;break}})},onLoad:function(){this.getBookList(),this.getSchoolList(),this.getArticleList()},onSearch:function(){this.page=1,this.list[this.listIndex].content=[],this.onLoad()},onCancel:function(){this.page=1,this.list[this.listIndex].content=[]},toSchool:function(t){this.$router.replace({name:"apps-school",query:{id:t.school_id}})}})},u=h,m=(a("640f"),a("2877")),p=Object(m["a"])(u,i,s,!1,null,"4ab7b4c0",null);e["default"]=p.exports},be6b:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("van-row",{attrs:{gutter:"20"}},[a("van-col",{attrs:{span:"7"}},[a("div",{staticClass:"book-cover"},[a("img",{attrs:{src:t.thumb(t.item.book_photo)},on:{error:t.imgError}}),t.item.is_read>0?a("div",{staticClass:"is-read"},[a("i",{staticClass:"iconfont"},[t._v("")])]):t._e()])]),a("van-col",{attrs:{span:"11"}},[a("div",{staticClass:"book-info",on:{click:t.toBookDetails}},[a("div",{directives:[{name:"line-clamp",rawName:"v-line-clamp:20",value:2,expression:"2",arg:"20"}],staticClass:"title"},[t._v(t._s(t.item.book_title))]),a("div",{staticClass:"attach"},[t.item.pos_name?a("div",{staticClass:"pos-title"},[t._v("书位："+t._s(t.item.pos_name))]):t._e()]),"guide"==t.type?a("div",{staticClass:"borrow"},[t._v("\n        借阅："+t._s(t.item.book_borrow_count)+" 次\n      ")]):t._e()])]),a("van-col",{attrs:{span:"6"}},[a("div",{staticClass:"button"},[a("div",{staticClass:"flex flex-align"},[a("div",{staticClass:"like",on:{click:t.addCollect}},[t.itemCollect?a("i",{staticClass:"iconfont"},[t._v("")]):a("i",{staticClass:"iconfont"},[t._v("")])]),a("div",{staticClass:"listening",on:{click:t.listening}},[a("i",{staticClass:"iconfont"},[t._v("")])])]),"在读"==t.type?a("div",{staticClass:"abrasion"},[a("van-button",{staticClass:"theme-btn",attrs:{plain:"",size:"small",type:"primary",round:""},on:{click:t.toBorrow}},[t._v("磨损")])],1):t._e()])])],1)},s=[],o=(a("a481"),a("4917"),a("9993")),n={name:"bookCard",props:["item","type","isCollect"],data:function(){return{itemCollect:!1}},watch:{isCollect:function(t){this.itemCollect=1==t}},methods:{thumb:function(t){if(t){var e=t.match(/https?:\/\/(.+?)\//);return e?"/book/api/remotePic?url=".concat(t):t}},listening:function(){var t=this,e=/（.+?）/,a=this.item.book_title.replace(e,""),i="https://m.ximalaya.com/search/".concat(a),s=localStorage.getItem("bookRead_"+this.item.book_id);s?location.href=i:o["a"].get("/book/story/updateRead").then(function(e){localStorage.setItem("bookRead_"+t.item.book_id,!0),location.href=i})},toBookDetails:function(){this.$router.push({name:"book-details",query:{id:this.item.book_id}})},addCollect:function(){var t=this,e={params:{target_id:this.item.book_id,type_id:5}};o["a"].get("/book/member/add_favorite",e).then(function(e){1==e.data.status&&(t.itemCollect=!t.itemCollect,t.itemCollect&&t.$toast.success({className:"like-icon toast-icon",duration:"800"}))})},toBorrow:function(){this.item.borrow_id&&(location.href="/book/MemberBookBroken/add/borrow_id/".concat(this.item.borrow_id,"?back_url=").concat(encodeURIComponent(location.href)))},imgError:function(t){t.target.src="https://assets-moonbook.oss-cn-beijing.aliyuncs.com/img/no-cover.jpg"}}},c=n,l=(a("f9b6"),a("2877")),r=Object(l["a"])(c,i,s,!1,null,"f522cdfc",null);e["a"]=r.exports},f9b6:function(t,e,a){"use strict";var i=a("350e"),s=a.n(i);s.a}}]);
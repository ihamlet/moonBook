(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-743241d9"],{"45e8":function(t,e,a){},"530a":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"new-book"},[a("img",{staticClass:"head-bg",attrs:{src:"https://assets-moonbook.oss-cn-beijing.aliyuncs.com/newBook.jpg"}}),a("div",{staticClass:"list-padding"},[a("van-pull-refresh",{key:t.userDataState.card_id,on:{refresh:t.onRefresh},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},[a("van-list",{attrs:{finished:t.finished,"finished-text":t.$store.state.slogan},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,function(e,o){return a("van-cell",{key:o},[t.timediff(e,o)?a("div",{staticClass:"hd-bar flex flex-align"},[a("div",{staticClass:"card-school-name theme-color",on:{click:t.toSchoolHome}},[t._v(t._s(0==o?t.userDataState.card_school_name:""))]),a("div",{staticClass:"time"},[t._v(t._s(t.getTimeAgo(e.create_time)))])]):t._e(),a("bookCard",{attrs:{item:e,type:t.list.title}})],1)}),1)],1)],1),a("div",{staticClass:"footer-bar"},[a("div",{staticClass:"btn-box"},[a("van-button",{staticClass:"theme-btn",attrs:{round:"",type:"primary",size:"normal"},on:{click:t.toBookShelf}},[t._v("去书架看看")])],1)])])},i=[],s=a("e20c"),n=a("9993"),c=a("591a"),l=a("bec1"),r=a("be6b"),d={name:"new-book",components:{bookCard:r["a"]},data:function(){return{loading:!1,finished:!1,page:1,list:[]}},computed:Object(s["a"])({},Object(c["c"])(["userDataState"])),methods:{onLoad:function(){var t=this,e={params:{sort:"new",start_time:Date.parse(new Date)-6048e5,card_id:this.userDataState.card_id}};return n["a"].get("/book/SchoolShelfBook/getList",e).then(function(e){switch(e.data.status){case 1:1==t.page?t.list=e.data.data:t.list=t.list.concat(e.data.data),t.loading=!1,t.page++,t.list.length>=e.data.count&&(t.finished=!0);break;case 0:t.page=1,t.loading=!1,t.finished=!0,t.list=[];break}})},onRefresh:function(){var t=this;this.page=1,this.onLoad().then(function(){t.loading=!1,t.finished=!1})},getTimeAgo:function(t){return Object(l["e"])(1e3*t,"yyyy-MM-dd")},timediff:function(t,e){if(0==e)return!0;if(e){var a=Object(l["e"])(1e3*this.list[e-1].create_time,"yyyy-MM-dd"),o=Object(l["e"])(1e3*t.create_time,"yyyy-MM-dd");return a!=o}},toBookShelf:function(){this.$router.push({name:"bookshelf"})},toSchoolHome:function(){this.$router.push({name:"apps-school",query:{id:this.userDataState.card_school_id}})}}},u=d,m=(a("a873"),a("17cc")),h=Object(m["a"])(u,o,i,!1,null,"7de206d4",null);e["default"]=h.exports},"8a29":function(t,e,a){},a873:function(t,e,a){"use strict";var o=a("45e8"),i=a.n(o);i.a},be6b:function(t,e,a){"use strict";var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("van-row",{attrs:{gutter:"20"}},[a("van-col",{attrs:{span:"7"}},[a("div",{staticClass:"book-cover"},[a("img",{attrs:{src:t.thumb(t.item.book_photo)},on:{error:t.imgError}}),t.item.is_read>0?a("div",{staticClass:"is-read"},[a("i",{staticClass:"iconfont"},[t._v("")])]):t._e()])]),a("van-col",{attrs:{span:"11"}},[a("div",{staticClass:"book-info",on:{click:t.toBookDetails}},[a("div",{directives:[{name:"line-clamp",rawName:"v-line-clamp:20",value:2,expression:"2",arg:"20"}],staticClass:"title"},[t._v(t._s(t.item.book_title))]),a("div",{staticClass:"attach"},[t.item.pos_name?a("div",{staticClass:"pos-title"},[t._v("书位："+t._s(t.item.pos_name))]):t._e()]),"guide"==t.type?a("div",{staticClass:"borrow"},[t._v("\n        借阅："+t._s(t.item.book_borrow_count)+" 次\n      ")]):t._e()])]),a("van-col",{attrs:{span:"6"}},[a("div",{staticClass:"button"},[a("div",{staticClass:"flex flex-align"},[a("div",{staticClass:"like",on:{click:t.addCollect}},[t.itemCollect?a("i",{staticClass:"iconfont"},[t._v("")]):a("i",{staticClass:"iconfont"},[t._v("")])]),a("div",{staticClass:"listening",on:{click:t.listening}},[a("i",{staticClass:"iconfont"},[t._v("")])])]),"在读"==t.type?a("div",{staticClass:"abrasion"},[a("van-button",{staticClass:"theme-btn",attrs:{plain:"",size:"small",type:"primary",round:""},on:{click:t.toBorrow}},[t._v("磨损")])],1):t._e()])])],1)},i=[],s=(a("34a3"),a("3c6b"),a("9993")),n={name:"bookCard",props:["item","type","isCollect"],data:function(){return{itemCollect:!1}},watch:{isCollect:function(t){this.itemCollect=1==t}},methods:{thumb:function(t){if(t){var e=t.match(/https?:\/\/(.+?)\//);return e?"/book/api/remotePic?url=".concat(t):t}},listening:function(){var t=this,e=/（.+?）/,a=this.item.book_title.replace(e,""),o="https://m.ximalaya.com/search/".concat(a),i=localStorage.getItem("bookRead_"+this.item.book_id);i?location.href=o:s["a"].get("/book/story/updateRead").then(function(e){localStorage.setItem("bookRead_"+t.item.book_id,!0),location.href=o})},toBookDetails:function(){this.$router.push({name:"book-details",query:{id:this.item.book_id}})},addCollect:function(){var t=this,e={params:{target_id:this.item.book_id,type_id:5}};s["a"].get("/book/member/add_favorite",e).then(function(e){1==e.data.status&&(t.itemCollect=!t.itemCollect,t.itemCollect&&t.$toast.success({className:"like-icon toast-icon",duration:"800"}))})},toBorrow:function(){this.item.borrow_id&&(location.href="/book/MemberBookBroken/add/borrow_id/".concat(this.item.borrow_id,"?back_url=").concat(encodeURIComponent(location.href)))},imgError:function(t){t.target.src="https://assets-moonbook.oss-cn-beijing.aliyuncs.com/img/no-cover.jpg"}}},c=n,l=(a("f9b6"),a("17cc")),r=Object(l["a"])(c,o,i,!1,null,"f522cdfc",null);e["a"]=r.exports},f9b6:function(t,e,a){"use strict";var o=a("8a29"),i=a.n(o);i.a}}]);
//# sourceMappingURL=chunk-743241d9.ee78a73a.js.map